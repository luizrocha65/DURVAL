<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Pontua√ß√µes</title>
<style>
body {font-family: Arial, sans-serif;background-color: #f7f9fb;display: flex;flex-direction: column;align-items: center;padding: 40px;}
.logo {width: 20cm;height: 3cm;margin-bottom: 15px;border-radius: 10px;box-shadow: 0 0 5px rgba(0,0,0,0.2);display: block;}
h1 { color: #333; }
.hidden { display: none; }
input:not([type="checkbox"]):not([type="radio"]),button,select {margin: 6px;padding: 8px;border-radius: 5px;border: 1px solid #ccc;}
input[type="checkbox"] {appearance: auto;width: 18px;height: 18px;margin: 0;cursor: pointer;}
button {background-color: #4CAF50;color: white;border: none;cursor: pointer;}
button:hover {background-color: #45a049;}
table {border-collapse: collapse;width: 90%;margin-top: 20px;background-color: white;box-shadow: 0 0 10px rgba(0,0,0,0.1);}
th, td {border: 1px solid #ccc;padding: 10px;text-align: center;}
th {background-color: #4CAF50;color: white;}
#alterarSenhaBox {background-color: #ffffff;border: 1px solid #ccc;padding: 20px;border-radius: 10px;width: 280px;margin-top: 20px;box-shadow: 0 0 5px rgba(0,0,0,0.1);}
.btn-danger { background-color: #d9534f; color: white; }
.btn-danger:hover { background-color: #c9302c; }
.actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
</style>
</head>
<body>
<img src="logo.png" alt="Logo da Escola" class="logo">
<h1>Sistema de Pontua√ß√µes</h1>
<div id="telaLogin">
  <h2>Login</h2>
  <select id="tipoUsuario">
    <option value="aluno">Aluno</option>
    <option value="professor">Professor</option>
  </select><br>
  <input type="text" id="usuario" placeholder="Usu√°rio (nome ou 'prof')"><br>
  <input type="password" id="senha" placeholder="Senha"><br>
  <button onclick="login()">Entrar</button>
</div>

<div id="painelProfessor" class="hidden">
  <h2>Painel do Professor üë®‚Äçüè´</h2>
  <button onclick="logout()">Sair</button><br><br>

  <h3>Importar lista de alunos via CSV</h3>
  <input type="file" id="csvFile" accept=".csv">
  <button onclick="importarListaAlunos()">Importar Lista</button><br><br>

  <h3>Cadastrar / Atualizar Aluno</h3>
  <input type="text" id="novoNome" placeholder="Nome completo do aluno">
  <input type="password" id="novaSenha" placeholder="Senha (opcional)">
  <input type="number" id="novaPontuacao" placeholder="Pontua√ß√£o">
  <button onclick="cadastrarOuAtualizarAluno()">Salvar</button>

  <h3>Lista de alunos</h3>
  <div class="actions">
    <button onclick="apagarSelecionados()">Apagar selecionados</button>
    <button class="btn-danger" onclick="apagarTodos()">Apagar todos</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selecionarTodos" title="Selecionar todos" onchange="selecionarTodos(this)"></th>
        <th>Nome</th>
        <th>Pontua√ß√£o</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabelaAlunos"></tbody>
  </table>
</div>

<div id="painelAluno" class="hidden">
  <h2>Painel do Aluno üë©‚Äçüéì</h2>
  <button onclick="logout()">Sair</button><br><br>
  <p><b>Nome:</b> <span id="alunoNome"></span></p>
  <p><b>Pontua√ß√£o:</b> <span id="alunoPontuacao"></span></p>

  <div id="alterarSenhaBox">
    <h3>Alterar Senha</h3>
    <input type="password" id="senhaAtual" placeholder="Senha atual"><br>
    <input type="password" id="novaSenhaAluno" placeholder="Nova senha"><br>
    <input type="password" id="confirmaSenhaAluno" placeholder="Confirmar nova senha"><br>
    <button onclick="alterarSenhaAluno()">Alterar</button>
  </div>
</div>

<script>
if (!localStorage.getItem("alunos")) localStorage.setItem("alunos", JSON.stringify([]));

const professor = { usuario: "prof", senha: "1234" };
let alunoLogado = null;

function login() {
  const tipo = document.getElementById("tipoUsuario").value;
  const usuario = document.getElementById("usuario").value.trim();
  const senha = document.getElementById("senha").value.trim();
  if (tipo === "professor") {
    if (usuario === professor.usuario && senha === professor.senha) mostrarPainelProfessor();
    else alert("Professor: usu√°rio ou senha incorretos!");
  } else {
    const alunos = JSON.parse(localStorage.getItem("alunos"));
    const aluno = alunos.find(a => a.nome.toLowerCase() === usuario.toLowerCase() && a.senha === senha);
    const alunoSenhaIgualNome = alunos.find(a => a.nome.toLowerCase() === usuario.toLowerCase() && senha.toLowerCase() === a.nome.toLowerCase());
    if (aluno || alunoSenhaIgualNome) { alunoLogado = aluno || alunoSenhaIgualNome; mostrarPainelAluno(alunoLogado); }
    else alert("Aluno: usu√°rio ou senha incorretos!");
  }
}

function mostrarPainelProfessor() {
  document.getElementById("telaLogin").classList.add("hidden");
  document.getElementById("painelProfessor").classList.remove("hidden");
  atualizarTabela();
}

function cadastrarOuAtualizarAluno() {
  const nome = document.getElementById("novoNome").value.trim();
  const senha = document.getElementById("novaSenha").value.trim() || nome;
  const pontuacao = parseInt(document.getElementById("novaPontuacao").value);
  if (!nome || isNaN(pontuacao)) { alert("Preencha o nome e a pontua√ß√£o!"); return; }
  let alunos = JSON.parse(localStorage.getItem("alunos"));
  const existente = alunos.find(a => a.nome.toLowerCase() === nome.toLowerCase());
  if (existente) { existente.pontuacao = pontuacao; existente.senha = senha; alert("Aluno atualizado!"); }
  else { alunos.push({ nome, senha, pontuacao }); alert("Aluno cadastrado!"); }
  localStorage.setItem("alunos", JSON.stringify(alunos));
  atualizarTabela();
  document.getElementById("novoNome").value = "";
  document.getElementById("novaSenha").value = "";
  document.getElementById("novaPontuacao").value = "";
}

function atualizarTabela() {
  const alunos = JSON.parse(localStorage.getItem("alunos"));
  const corpo = document.getElementById("tabelaAlunos");
  corpo.innerHTML = "";
  alunos.forEach(a => {
    const linha = document.createElement("tr");
    linha.innerHTML = `<td><input type="checkbox" class="selecionado" data-nome="${a.nome}"></td>
                       <td>${a.nome}</td><td>${a.pontuacao}</td>
                       <td><button onclick="editarAluno('${a.nome}')">Editar</button></td>`;
    corpo.appendChild(linha);
  });
}

function selecionarTodos(cb) {
  document.querySelectorAll(".selecionado").forEach(ch => ch.checked = cb.checked);
}

function apagarSelecionados() {
  const selecionados = document.querySelectorAll(".selecionado:checked");
  if (selecionados.length === 0) return alert("Selecione pelo menos um aluno!");
  if (!confirm("Deseja apagar os alunos selecionados?")) return;
  let alunos = JSON.parse(localStorage.getItem("alunos"));
  selecionados.forEach(cb => { alunos = alunos.filter(a => a.nome !== cb.dataset.nome); });
  localStorage.setItem("alunos", JSON.stringify(alunos));
  atualizarTabela();
  alert("Alunos selecionados apagados.");
}

/* NOVO BOT√ÉO APAGAR TODOS */
function apagarTodos() {
  const alunos = JSON.parse(localStorage.getItem("alunos"));
  if (!alunos || alunos.length === 0) return alert("N√£o h√° alunos para apagar.");
  if (!confirm("Tem certeza que deseja apagar TODOS os alunos? Esta a√ß√£o √© irrevers√≠vel.")) return;
  localStorage.setItem("alunos", JSON.stringify([]));
  atualizarTabela();
  alert("Todos os alunos foram apagados.");
}

function editarAluno(nome) {
  const alunos = JSON.parse(localStorage.getItem("alunos"));
  const aluno = alunos.find(a => a.nome === nome);
  document.getElementById("novoNome").value = aluno.nome;
  document.getElementById("novaSenha").value = aluno.senha;
  document.getElementById("novaPontuacao").value = aluno.pontuacao;
}

function mostrarPainelAluno(aluno) {
  document.getElementById("telaLogin").classList.add("hidden");
  document.getElementById("painelAluno").classList.remove("hidden");
  document.getElementById("alunoNome").textContent = aluno.nome;
  document.getElementById("alunoPontuacao").textContent = aluno.pontuacao;
}

function alterarSenhaAluno() {
  const senhaAtual = document.getElementById("senhaAtual").value.trim();
  const novaSenha = document.getElementById("novaSenhaAluno").value.trim();
  const confirma = document.getElementById("confirmaSenhaAluno").value.trim();
  if (!senhaAtual || !novaSenha || !confirma) return alert("Preencha todos os campos!");
  if (novaSenha !== confirma) return alert("As senhas n√£o coincidem!");
  const alunos = JSON.parse(localStorage.getItem("alunos"));
  const aluno = alunos.find(a => a.nome === alunoLogado.nome);
  if (senhaAtual !== aluno.senha && senhaAtual.toLowerCase() !== aluno.nome.toLowerCase()) return alert("Senha atual incorreta!");
  aluno.senha = novaSenha;
  localStorage.setItem("alunos", JSON.stringify(alunos));
  alert("Senha alterada!");
}

function importarListaAlunos() {
  const file = document.getElementById("csvFile").files[0];
  if (!file) return alert("Selecione um arquivo CSV primeiro!");
  const reader = new FileReader();
  reader.onload = e => {
    const linhas = e.target.result.split(/\r?\n/);
    let alunos = JSON.parse(localStorage.getItem("alunos"));
    linhas.forEach((linha, i) => {
      if (linha.trim() === "" || i === 0) return;
      const nome = linha.split(/;|,/)[0].trim();
      if (nome && !alunos.find(a => a.nome.toLowerCase() === nome.toLowerCase()))
        alunos.push({ nome, senha: nome, pontuacao: 0 });
    });
    localStorage.setItem("alunos", JSON.stringify(alunos));
    atualizarTabela();
    alert("Lista importada!");
  };
  reader.readAsText(file);
}

function logout() {
  document.getElementById("telaLogin").classList.remove("hidden");
  document.getElementById("painelProfessor").classList.add("hidden");
  document.getElementById("painelAluno").classList.add("hidden");
}
</script>
</body>
</html>
